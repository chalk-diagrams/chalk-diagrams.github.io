<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Chalk Diagrams - A declarative drawing API"><meta name=author content="Dan Oneață and Alexander Rush"><link href=https://chalk-diagrams.github.io/api/internals/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.0, mkdocs-material-8.1.3"><title>Chalk internals - chalk-diagrams</title><link rel=stylesheet href=../../assets/stylesheets/main.edf004c2.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.e6a45f82.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../assets/css-js/termynal/css/termynal.css><link rel=stylesheet href=../../assets/css-js/termynal/css/custom.css><link rel=stylesheet href=../../assets/css-js/general/css/progressbar.css><link rel=stylesheet href=../../assets/css-js/mkdocs-tooltips/css/hint.min.css><link rel=stylesheet href=../../assets/css-js/mkdocs-tooltips/css/custom.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css><link rel=stylesheet href=../../assets/css-js/fastapi/custom.css><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=amber> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#core-data-types class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=chalk-diagrams class="md-header__button md-logo" aria-label=chalk-diagrams data-md-component=logo> <img src=../../logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> chalk-diagrams </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Chalk internals </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=amber aria-hidden=true type=radio name=__palette id=__palette_1> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/chalk-diagrams/chalk title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../shapes/ class="md-tabs__link md-tabs__link--active"> API </a> </li> <li class=md-tabs__item> <a href=../../examples/bigben/ class=md-tabs__link> Examples </a> </li> <li class=md-tabs__item> <a href=../../about/ class=md-tabs__link> About </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=chalk-diagrams class="md-nav__button md-logo" aria-label=chalk-diagrams data-md-component=logo> <img src=../../logo.png alt=logo> </a> chalk-diagrams </label> <div class=md-nav__source> <a href=https://github.com/chalk-diagrams/chalk title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> API <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=API data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../shapes/ class=md-nav__link> Shapes </a> </li> <li class=md-nav__item> <a href=../alignment/ class=md-nav__link> Alignment </a> </li> <li class=md-nav__item> <a href=../combinators/ class=md-nav__link> Combinators </a> </li> <li class=md-nav__item> <a href=../transformations/ class=md-nav__link> Transformations </a> </li> <li class=md-nav__item> <a href=../style/ class=md-nav__link> Style </a> </li> <li class=md-nav__item> <a href=../rendering/ class=md-nav__link> Rendering </a> </li> <li class=md-nav__item> <a href=../trails/ class=md-nav__link> Trails </a> </li> <li class=md-nav__item> <a href=../names/ class=md-nav__link> Connections </a> </li> <li class=md-nav__item> <a href=../utils/ class=md-nav__link> Utils </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Internals <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Internals </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#core-data-types class=md-nav__link> Core data types </a> </li> <li class=md-nav__item> <a href=#support-for-functional-and-object-oriented-use class=md-nav__link> Support for functional and object-oriented use </a> </li> <li class=md-nav__item> <a href=#trail-like-data-types class=md-nav__link> Trail-like data types </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Examples <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Examples data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../examples/bigben/ class=md-nav__link> BigBen </a> </li> <li class=md-nav__item> <a href=../../examples/hanoi/ class=md-nav__link> Hanoi </a> </li> <li class=md-nav__item> <a href=../../examples/koch/ class=md-nav__link> Koch </a> </li> <li class=md-nav__item> <a href=../../examples/lenet/ class=md-nav__link> LeNet </a> </li> <li class=md-nav__item> <a href=../../examples/squares/ class=md-nav__link> Squares </a> </li> <li class=md-nav__item> <a href=../../examples/tensor/ class=md-nav__link> Tensor </a> </li> <li class=md-nav__item> <a href=../../examples/tree/ class=md-nav__link> Tree </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <div class="md-nav__link md-nav__link--index "> <a href=../../about/ >About</a> <label for=__nav_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=About data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../about/license/ class=md-nav__link> License </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#core-data-types class=md-nav__link> Core data types </a> </li> <li class=md-nav__item> <a href=#support-for-functional-and-object-oriented-use class=md-nav__link> Support for functional and object-oriented use </a> </li> <li class=md-nav__item> <a href=#trail-like-data-types class=md-nav__link> Trail-like data types </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Internals</h1> <p>This document presents information on the internal implementation of the Chalk library. This information should not be needed by the casual user of the library, but it can certainly be useful to developers and also provides a record of the major design decisions. While much of the functionality of the Chalk library resembles the <a href=https://diagrams.github.io/ >Haskell <code>diagrams</code> library</a>, there are important distinctions in the implementation due to the differences of the two languages (Python and Haskell).</p> <h2 id=core-data-types>Core data types<a class=headerlink href=#core-data-types title="Permanent link">&para;</a></h2> <p>Chalk is an embedded domain specific language (EDSL). The two extremes of language design are shallow and deep EDSLs. Loosely put, a shallow EDSL specifies the language through a set of functions, while a deep EDSL specifies the syntax of the language using a data type (the abstract syntax tree; AST), which is then interpreted using given evaluator functions. Chalk uses a hybrid approach which defines an intermediate core data structure (in our case, the <code>Diagram</code> type) and a suite of functions that operate on this type. (For more information on the concepts of deep and shallow EDSLs, see <a href=http://www.cs.ox.ac.uk/jeremy.gibbons/publications/embedding.pdf>the paper of Gibbons and Wu from ICFP'14</a>).</p> <p>The <code>Diagram</code> type (implemented as <code>BaseDiagram</code> in <code>chalk/core.py</code>) can be thought as an <a href=https://en.wikipedia.org/wiki/Algebraic_data_type>algebraic data type</a> with the following six variants: <code>Empty</code>, <code>Primitive</code>, <code>Compose</code>, <code>ApplyTransform</code>, <code>ApplyStyle</code>, <code>ApplyName</code>. Each of the variants may hold additional information, as follows:</p> <div class=highlight><pre><span></span><code><span class=k>class</span> <span class=nc>Empty</span><span class=p>(</span><span class=n>BaseDiagram</span><span class=p>):</span>
    <span class=k>pass</span>

<span class=k>class</span> <span class=nc>Primitive</span><span class=p>(</span><span class=n>BaseDiagram</span><span class=p>):</span>
    <span class=n>shape</span><span class=p>:</span> <span class=n>Shape</span>
    <span class=n>style</span><span class=p>:</span> <span class=n>Style</span>
    <span class=n>transform</span><span class=p>:</span> <span class=n>Affine</span>

<span class=k>class</span> <span class=nc>Compose</span><span class=p>(</span><span class=n>BaseDiagram</span><span class=p>):</span>
    <span class=n>envelope</span><span class=p>:</span> <span class=n>Envelope</span>
    <span class=n>diagram1</span><span class=p>:</span> <span class=n>Diagram</span>
    <span class=n>diagram2</span><span class=p>:</span> <span class=n>Diagram</span>

<span class=k>class</span> <span class=nc>ApplyTransform</span><span class=p>(</span><span class=n>BaseDiagram</span><span class=p>):</span>
    <span class=n>transform</span><span class=p>:</span> <span class=n>Affine</span>
    <span class=n>diagram</span><span class=p>:</span> <span class=n>Diagram</span>

<span class=k>class</span> <span class=nc>ApplyStyle</span><span class=p>(</span><span class=n>BaseDiagram</span><span class=p>):</span>
    <span class=n>style</span><span class=p>:</span> <span class=n>Style</span>
    <span class=n>diagram</span><span class=p>:</span> <span class=n>Diagram</span>

<span class=k>class</span> <span class=nc>ApplyName</span><span class=p>(</span><span class=n>BaseDiagram</span><span class=p>):</span>
    <span class=n>dname</span><span class=p>:</span> <span class=nb>str</span>
    <span class=n>diagram</span><span class=p>:</span> <span class=n>Diagram</span>
</code></pre></div> <p>Instances of <code>BaseDiagram</code> can be constructed and modified using the functions provided by the library. For example, <div class=highlight><pre><span></span><code><span class=n>circle</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> generates the following AST: <div class=highlight><pre><span></span><code><span class=n>Primitive</span><span class=p>(</span><span class=n>shape</span><span class=o>=</span><span class=n>Path</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>style</span><span class=o>=</span><span class=n>Style</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>transform</span><span class=o>=</span><span class=n>Affine</span><span class=p>(</span><span class=o>...</span><span class=p>))</span>
</code></pre></div> and <div class=highlight><pre><span></span><code><span class=n>circle</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>|</span> <span class=n>circle</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> generates the following AST: <div class=highlight><pre><span></span><code><span class=n>Compose</span><span class=p>(</span>
    <span class=n>envelope</span><span class=o>=...</span><span class=p>,</span>
    <span class=n>diagram1</span><span class=o>=</span><span class=n>Primitive</span><span class=p>(</span><span class=n>shape</span><span class=o>=</span><span class=n>Path</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>style</span><span class=o>=</span><span class=n>Style</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>transform</span><span class=o>=</span><span class=n>Affine</span><span class=p>(</span><span class=o>...</span><span class=p>)),</span>
    <span class=n>diagram2</span><span class=o>=</span><span class=n>Primitive</span><span class=p>(</span><span class=n>shape</span><span class=o>=</span><span class=n>Path</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>style</span><span class=o>=</span><span class=n>Style</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>transform</span><span class=o>=</span><span class=n>Affine</span><span class=p>(</span><span class=o>...</span><span class=p>)),</span>
<span class=p>)</span>
</code></pre></div> A <code>Diagram</code> AST can be interpreted in multiple ways, arguably the most obvious being through the rendering functions (see the <code>chalk/backend</code> submodule); other interpretations are flattening the <code>Diagram</code> AST to a list of <code>Primitive</code>s or extracting the <code>Envelope</code> or <code>Trace</code> of a <code>Diagram</code>. All these functions are implemented using the <a href=https://en.wikipedia.org/wiki/Visitor_pattern#Python_example>visitor pattern</a>, which is the object-oriented correspondent of pattern matching and folding encountered in functional programming. (Jeremy Gibbons provides a nice exposition on the relationship between object-oriented design patterns and their functional counterparts in his paper <a href=http://www.cs.ox.ac.uk/jeremy.gibbons/publications/hodgp.pdf>Design Patterns as Higher-Order Datatype-Generic Programs</a>).</p> <h2 id=support-for-functional-and-object-oriented-use>Support for functional and object-oriented use<a class=headerlink href=#support-for-functional-and-object-oriented-use title="Permanent link">&para;</a></h2> <p>Internally the library is implemented in a functional style, through functions that operate on the <code>Diagram</code> AST. For example, for composition we have a combinator function <code>beside</code> (in <code>chalk/combinators.py</code>) that takes two <code>Diagram</code>s and returns a new <code>Diagram</code> corresponding to their composition. The main benefit of using functions is that the library can be easily split into self-contained submodules, each pertaining to a certain type of functionality (shapes, alignment, transformations, and so on). In contrast, using an object-oriented style would bundle the entire functionality as methods inside the class and would only allow to separate the variants (e.g., <code>Empty</code>, <code>Primitive</code>, <code>Compose</code>) across files (see the <a href=https://en.wikipedia.org/wiki/Expression_problem>"expression problem"</a> for the trade-offs between the functional and object-oriented style).</p> <p>However, allowing to write code in an object-oriented style (using dot notation) provides an arguably more convenient and idiomatic style in Python. For this reason, we attach all the functions as methods in the <code>chalk/core.py</code> file; for example: <div class=highlight><pre><span></span><code><span class=k>class</span> <span class=nc>BaseDiagram</span><span class=p>:</span>
    <span class=n>beside</span> <span class=o>=</span> <span class=n>chalk</span><span class=o>.</span><span class=n>combinators</span><span class=o>.</span><span class=n>beside</span>
</code></pre></div> This implementation allows writing <div class=highlight><pre><span></span><code><span class=n>circle</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>beside</span><span class=p>(</span><span class=n>circle</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span> <span class=n>unit_x</span><span class=p>)</span>
</code></pre></div> and even more succinctly <div class=highlight><pre><span></span><code><span class=n>circle</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>|</span> <span class=n>circle</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> as we define <a href=https://docs.python.org/3/reference/datamodel.html#special-method-names>"dunder" methods</a> for common combinators (<code>__or__</code> in this case).</p> <p>The challenge of this implementation decision is that it complicates the <a href=https://mypy.readthedocs.io/en/stable/index.html#>type checking</a> due to circular imports. We solve this problem by introducing a <code>Diagram</code> <a href=https://mypy.readthedocs.io/en/stable/protocols.html>protocol</a> (in <code>chalk/types.py</code>), which specifies type signatures for all the methods that are to be implemented later on. The <code>Diagram</code> type is used throughout the code for type hinting, for example: <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>juxtapose</span><span class=p>(</span><span class=bp>self</span><span class=p>:</span> <span class=n>Diagram</span><span class=p>,</span> <span class=n>other</span><span class=p>:</span> <span class=n>Diagram</span><span class=p>,</span> <span class=n>direction</span><span class=p>:</span> <span class=n>V2</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Diagram</span><span class=p>:</span>
    <span class=c1># We can use `get_envelope` here since the `Diagram` protocol promises</span>
    <span class=c1># that such a method will be implemented.</span>
</code></pre></div> The concrete implementation of the <code>Diagram</code> protocol is provided by the <code>BaseDiagram</code> in <code>chalk/core.py</code>.</p> <h2 id=trail-like-data-types>Trail-like data types<a class=headerlink href=#trail-like-data-types title="Permanent link">&para;</a></h2> <p>Apart from the main <code>Diagram</code> data type, there are several other related types (<code>Trail</code>, <code>Located</code>, <code>Path</code>) that encode a trail-like drawing and can be "lifted" to a <code>Diagram</code> using the <code>stroke</code> method. These trail-like structures encode different types of information and, as a consequence, have different combination semantics:</p> <ul> <li><code>Trail</code> corresponds to a list of vectors (translation-invariant offsets, which can be either straight or bendy—implemented as arcs). A <code>Trail</code> is <code>Transformable</code> (by transforming each of the vectors), but since vectors are translation-invariant, applying <code>translate</code> leaves a <code>Trail</code> unchanged. The monoid composition corresponds to the list monoid: it <em>extends</em> the first trail with the second one. A <code>Trail</code> can be closed which means that it is a loop and it will be able to hold a color when filled in.</li> <li><code>Located</code> is a <code>Trail</code> paired with a <code>location</code> origin point. A <code>Trail</code> can be turned into <code>Located</code> using the <code>at</code> method which specifies the origin location. <code>Located</code> instances do not form a monoid.</li> <li><code>Path</code> is a list of <code>Located</code> instances. Having more than one <code>Located</code> instance is important, since it allows to easily draw objects with holes in them (such as rings). The monoid composition also corresponds to the list monoid, but the effects is different from <code>Trail</code>: it <em>overlays</em> the <code>Located</code> subpaths.</li> </ul> <p>Below we present an example (inspired from the <code>diagrams</code> library) that showcases the distinction of the combination semantics (the <code>concat</code> function) for the <code>Diagram</code>, <code>Path</code>, <code>Trail</code> types.</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>colour</span> <span class=kn>import</span> <span class=n>Color</span>
<span class=kn>from</span> <span class=nn>toolz</span> <span class=kn>import</span> <span class=n>iterate</span><span class=p>,</span> <span class=n>take</span>
<span class=kn>from</span> <span class=nn>chalk</span> <span class=kn>import</span> <span class=o>*</span>

<span class=n>red</span> <span class=o>=</span> <span class=n>Color</span><span class=p>(</span><span class=s2>&quot;red&quot;</span><span class=p>)</span>
<span class=n>t</span> <span class=o>=</span> <span class=n>Trail</span><span class=o>.</span><span class=n>regular_polygon</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<span class=n>t_loc</span> <span class=o>=</span> <span class=n>t</span><span class=o>.</span><span class=n>centered</span><span class=p>()</span>

<span class=c1># Diagram</span>
<span class=n>dia1</span> <span class=o>=</span> <span class=n>concat</span><span class=p>(</span><span class=n>take</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=n>iterate</span><span class=p>(</span><span class=k>lambda</span> <span class=n>d</span><span class=p>:</span> <span class=n>d</span><span class=o>.</span><span class=n>rotate_by</span><span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=mi>9</span><span class=p>),</span> <span class=n>t_loc</span><span class=o>.</span><span class=n>stroke</span><span class=p>())))</span><span class=o>.</span><span class=n>fill_color</span><span class=p>(</span><span class=n>red</span><span class=p>)</span>

<span class=c1># Path</span>
<span class=n>dia2</span> <span class=o>=</span> <span class=n>Path</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>take</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=n>iterate</span><span class=p>(</span><span class=k>lambda</span> <span class=n>d</span><span class=p>:</span> <span class=n>d</span><span class=o>.</span><span class=n>rotate_by</span><span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=mi>9</span><span class=p>),</span> <span class=n>t_loc</span><span class=o>.</span><span class=n>to_path</span><span class=p>())))</span><span class=o>.</span><span class=n>stroke</span><span class=p>()</span><span class=o>.</span><span class=n>fill_color</span><span class=p>(</span><span class=n>red</span><span class=p>)</span>

<span class=c1># Trail</span>
<span class=n>dia3</span> <span class=o>=</span> <span class=n>Trail</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>take</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=n>iterate</span><span class=p>(</span><span class=k>lambda</span> <span class=n>d</span><span class=p>:</span> <span class=n>d</span><span class=o>.</span><span class=n>rotate_by</span><span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=mi>9</span><span class=p>),</span> <span class=n>t</span><span class=p>)))</span><span class=o>.</span><span class=n>stroke</span><span class=p>()</span><span class=o>.</span><span class=n>center_xy</span><span class=p>()</span>

<span class=n>hcat</span><span class=p>([</span><span class=n>dia1</span><span class=p>,</span> <span class=n>dia2</span><span class=p>,</span> <span class=n>dia3</span><span class=p>],</span> <span class=n>sep</span><span class=o>=</span><span class=mf>0.2</span><span class=p>)</span>
</code></pre></div> <p><img src=https://user-images.githubusercontent.com/819256/184515950-b3ce4245-19ee-4357-bc3a-f32f993b04ef.png></p> <hr> <div class=md-source-file> <small> Last update: 2022-08-22 </small> </div> <style>
// Do whatever changes you need here

.jp-RenderedHTMLCommon p {
    color: red;
}

.jupyter-wrapper .jp-CodeCell .jp-Cell-inputWrapper .jp-InputPrompt {
   display: none;
}
.jupyter-wrapper .jp-CodeCell .jp-Cell-outputWrapper .jp-OutputPrompt {
   display: none;
}

.jupyter-wrapper .celltag_hide {
   display: none;
}

.jupyter-wrapper .celltag_hide_inp .jp-InputArea {
   display: none;
}

.jupyter-wrapper .jp-OutputArea-output dt {
    width: 100%;
}
.jupyter-wrapper .jp-OutputArea-output dd {
    width: 100%;
    margin-left: 20px;
}

.jupyter-wrapper .jp-OutputArea-output.jp-RenderedSVG {
    text-align: center;
    padding-top: 10px;
}

</style> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../utils/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Utils" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Utils </div> </div> </a> <a href=../../examples/bigben/ class="md-footer__link md-footer__link--next" aria-label="Next: BigBen" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> BigBen </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Maintained by <a href=https://github.com/danoneata>Dan Oneață</a> and <a href=https://github.com/srush>Alexander Rush</a>. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tabs.link", "navigation.indexes", "navigation.instant", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", {"toc.integrate": false}], "search": "../../assets/javascripts/workers/search.0bbba5b5.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.e1a181d9.min.js></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js></script> <script src=../../assets/css-js/general/js/tables.js></script> <script src=../../assets/css-js/termynal/js/termynal.js></script> <script src=../../assets/css-js/termynal/js/custom.js></script> <script src=../..></script> <script src=https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js></script> <script src=../../assets/css-js/general/js/highlight-config.js></script> <script src=https://unpkg.com/d3@6.7.0/dist/d3.min.js></script> <script src=https://unpkg.com/markmap-lib@0.11.5/dist/browser/index.min.js></script> <script src=https://unpkg.com/markmap-view@0.2.6/dist/index.min.j></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=../../assets/css-js/fastapi/custom.js></script> <script src=../../assets/css-js/fastapi/chat.js></script> </body> </html>